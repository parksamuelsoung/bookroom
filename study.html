<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="form-container">
    <h1>Verse Study Quiz</h1>

    <!-- Mode Selection -->
    <label for="mode">Mode:</label>
    <select id="mode">
      <option value="copy">Copy</option>
      <option value="memorize">Memorize</option>
    </select>

    <!-- Verse Selection -->
    <label for="bookSelect">Select Book:</label>
    <select id="bookSelect" onchange="loadChapters()">
      <option value="">--Choose Book--</option>
      <option value="Genesis">Genesis</option>
      <option value="Joel">Joel</option>
      <option value="John">John</option>
      <option value="Acts">Acts</option>
      <option value="Romans">Romans</option>
      <option value="1 Corinthians">1 Corinthians</option>
    </select>

    <label for="chapterSelect">Select Chapter:</label>
    <select id="chapterSelect" onchange="loadVerses()">
      <option value="">--Choose Chapter--</option>
    </select>

    <label for="verseSelect">Select Verse:</label>
    <select id="verseSelect">
      <option value="">--Choose Verse--</option>
    </select>

    <button onclick="addVerse()">Add Verse</button>

    <!-- Quiz Section -->
    <div id="quizSection" class="hidden">
      <p id="questionDisplay"></p>
      <textarea 
        id="userInput" 
        placeholder="Type here"
        oninput="autoResize(this)"
        style="width: 90%; overflow:hidden; resize:none; min-height: 3em;"
        rows="1"
      ></textarea>
      <button onclick="submitAnswer()">Submit</button>
    </div>

    <button onclick="startQuiz()">Start Quiz</button>
    <button onclick="refreshPage()">Reset Quiz</button>

    <p id="status"></p>
  </div>

  <script>
    // Resizing textarea
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = (textarea.scrollHeight) + 'px';
    }

    const bibleVerses = {
      "Genesis": { "4": { "26": "And to Seth also a son was born..." } },
      "Joel": { "2": { "32": "And everyone who calls on the name..." } },
      "John": { "3": { "16": "For God so loved the world...", "17": "For God did not send the Son..." } },
      "Acts": { "2": { "21": "And it shall be that everyone..." } },
      "Romans": { "10": { "12": "For there is no distinction...", "13": "For 'whoever calls...'" } },
      "1 Corinthians": { "1": { "2": "To the church of God which is in Corinth..." } }
    };

    const selectedVerses = {};
    let currentQueue = [];
    let currentVerse = null;

    function loadChapters() {
      const book = document.getElementById("bookSelect").value;
      const chapterSelect = document.getElementById("chapterSelect");
      chapterSelect.innerHTML = '<option value="">--Choose Chapter--</option>';
      if (bibleVerses[book]) {
        for (let chapter in bibleVerses[book]) {
          chapterSelect.innerHTML += `<option value="${chapter}">${chapter}</option>`;
        }
      }
    }

    function loadVerses() {
      const book = document.getElementById("bookSelect").value;
      const chapter = document.getElementById("chapterSelect").value;
      const verseSelect = document.getElementById("verseSelect");
      verseSelect.innerHTML = '<option value="">--Choose Verse--</option>';
      if (bibleVerses[book] && bibleVerses[book][chapter]) {
        for (let verse in bibleVerses[book][chapter]) {
          verseSelect.innerHTML += `<option value="${verse}">${verse}</option>`;
        }
      }
    }

    function addVerse() {
      const book = document.getElementById("bookSelect").value;
      const chapter = document.getElementById("chapterSelect").value;
      const verse = document.getElementById("verseSelect").value;

      if (!book || !chapter || !verse) return;

      const ref = `${book} ${chapter}:${verse}`;
      if (!selectedVerses[ref]) {
        selectedVerses[ref] = { text: bibleVerses[book][chapter][verse], correctCount: 0 };
      }

      document.getElementById("status").textContent = `Added: ${ref}`;
    }

    function startQuiz() {
      currentQueue = Object.entries(selectedVerses).filter(([_, data]) => data.correctCount < 3);
      if (currentQueue.length === 0) {
        alert("Please add verses to study.");
        return;
      }
      document.getElementById("quizSection").classList.remove("hidden");
      showNextQuestion();
    }

    function showNextQuestion() {
      if (currentQueue.length === 0) {
        document.getElementById("questionDisplay").textContent = "Congratulations! You've mastered all verses.";
        document.getElementById("quizSection").classList.add("hidden");
        return;
      }

      const randomIndex = Math.floor(Math.random() * currentQueue.length);
      currentVerse = currentQueue[randomIndex];
      const mode = document.getElementById("mode").value;

      const ref = currentVerse[0];
      const text = currentVerse[1].text;

      document.getElementById("userInput").value = "";
      document.getElementById("questionDisplay").textContent = mode === "copy" ? `${ref}: ${text}` : ref;
    }

    function submitAnswer() {
      const input = document.getElementById("userInput").value.trim();
      const mode = document.getElementById("mode").value;
      const ref = currentVerse[0];
      const text = currentVerse[1].text;
      const correctAnswer = `${ref} ${text}`;

      if (input === correctAnswer) {
        selectedVerses[ref].correctCount++;
        currentQueue = currentQueue.filter(([key]) => key !== ref);
        document.getElementById("status").textContent = `Correct! (${ref})`;
      } else {
        document.getElementById("status").textContent = `Incorrect. (${ref})`;
      }

      showNextQuestion();
    }

    function refreshPage() {
      window.location.reload();
    }
  </script>
</body>
</html>
